<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Acompanhamento de Produ√ß√£o de V√≠deos</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF para o Otimizador Gold -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        /* √çcones b√°sicos j√° incorporados com CSS para evitar depend√™ncias externas */
        .icon-up:after { content: "‚ñ≤"; }
        .icon-down:after { content: "‚ñº"; }
        .icon-edit:after { content: "‚úé"; }
        .icon-checked:after { content: "‚òë"; }
        .icon-unchecked:after { content: "‚òê"; }
        .icon-calendar:after { content: "üìÖ"; }
        .icon-download:after { content: "üíæ"; }
        .icon-upload:after { content: "üì§"; }
        .icon-delete:after { content: "üóëÔ∏è"; }
        .icon-left:after { content: "‚óÄ"; }
        .icon-right:after { content: "‚ñ∂"; }
        .icon-tool:after { content: "üîß"; }
        
        /* Estilo para destaque de tarefa */
        @keyframes highlightAnimation {
            0% { background-color: #FECACA; } /* red-200 */
            50% { background-color: #FEE2E2; } /* red-100 */
            100% { background-color: transparent; }
        }
        
        .task-highlight {
            animation: highlightAnimation 2s ease-in-out;
        }
        
        /* Estilos para o Otimizador Gold */
        .gold-bg {
            background-color: #DAA520;
        }
        .gold-text {
            color: #DAA520;
        }
        .gold-border {
            border-color: #B8860B;
        }
        .gold-input {
            background-color: #FFD700;
            color: #4B0082;
            border: 1px solid #B8860B;
        }
        .gold-button {
            background-color: #DAA520;
            color: white;
            transition: background-color 0.3s, transform 0.2s;
        }
        .gold-button:hover {
            background-color: #FFD700;
            transform: translateY(-2px);
        }
        .block {
            width: 100%;
            padding: 15px;
            background-color: #DAA520;
            border: 1px solid #B8860B;
            border-radius: 5px;
            position: relative;
            color: #FFFFFF;
            margin-bottom: 10px;
        }
        .block .info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .block .srt {
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="p-4 max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Sistema de Acompanhamento de Produ√ß√£o de V√≠deos</h1>
            <div class="flex items-center gap-2 text-sm text-gray-600">
                <span id="lastSaved"></span>
                <div class="flex gap-1">
                    <button onclick="exportData()" class="p-1 rounded hover:bg-gray-200" title="Exportar dados">
                        <span class="icon-download"></span>
                    </button>
                    <label class="p-1 rounded hover:bg-gray-200 cursor-pointer" title="Importar dados">
                        <span class="icon-upload"></span>
                        <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                    </label>
                </div>
            </div>
        </div>

        <!-- Calend√°rio -->
        <div class="mb-8 overflow-x-auto bg-white rounded-lg shadow p-4" style="min-height: 300px;">
            <div class="flex items-center justify-center gap-4 mb-4">
                <button onclick="navigateMonth(-1)" class="p-1 hover:bg-gray-100 rounded" title="M√™s anterior">
                    <span class="icon-left"></span>
                </button>
                
                <h2 class="text-xl font-semibold flex items-center gap-2">
                    <span class="icon-calendar"></span>
                    <span id="calendarTitle">Calend√°rio de Produ√ß√£o</span>
                </h2>
                
                <button onclick="navigateMonth(1)" class="p-1 hover:bg-gray-100 rounded" title="Pr√≥ximo m√™s">
                    <span class="icon-right"></span>
                </button>
            </div>
            
            <div id="calendarMatrix" class="min-w-max">
                <!-- O calend√°rio ser√° gerado via JavaScript -->
            </div>
        </div>

        <!-- Formul√°rio -->
        <div class="bg-white rounded-lg shadow p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Registro de Tarefas</h2>
                <button id="toggleFormBtn" class="p-1 rounded hover:bg-gray-100">
                    <span class="icon-up"></span>
                </button>
            </div>

            <div id="taskForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Canal</label>
                        <input
                            type="text"
                            id="channel"
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Nome do canal"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">C√≥digo do V√≠deo</label>
                        <input
                            type="text"
                            id="videoCode"
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="C√≥digo do v√≠deo (opcional)"
                        >
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">T√≠tulo do V√≠deo</label>
                    <input
                        type="text"
                        id="title"
                        maxlength="200"
                        class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="T√≠tulo do v√≠deo (m√°x. 200 caracteres)"
                        oninput="updateCharCount('title', 'titleCount', 200)"
                    >
                    <div id="titleCount" class="text-xs text-gray-500 mt-1">0/200 caracteres</div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Descri√ß√£o</label>
                    <textarea
                        id="description"
                        maxlength="2000"
                        rows="3"
                        class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Descri√ß√£o do v√≠deo (m√°x. 2000 caracteres)"
                        oninput="updateCharCount('description', 'descriptionCount', 2000)"
                    ></textarea>
                    <div id="descriptionCount" class="text-xs text-gray-500 mt-1">0/2000 caracteres</div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Data Programada</label>
                        <div class="flex gap-2">
                            <div class="w-1/3">
                                <select id="scheduledDay" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Dia</option>
                                    <!-- Os dias ser√£o preenchidos via JavaScript -->
                                </select>
                            </div>
                            <div class="w-1/3">
                                <select id="scheduledMonth" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">M√™s</option>
                                    <option value="0">Janeiro</option>
                                    <option value="1">Fevereiro</option>
                                    <option value="2">Mar√ßo</option>
                                    <option value="3">Abril</option>
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select>
                            </div>
                            <div class="w-1/3">
                                <select id="scheduledYear" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ano</option>
                                    <!-- Os anos ser√£o preenchidos via JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="scriptDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="scriptDone" class="ml-2 text-sm text-gray-700">Roteiro</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="narrationDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="narrationDone" class="ml-2 text-sm text-gray-700">Narra√ß√£o</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="imagesDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="imagesDone" class="ml-2 text-sm text-gray-700">Imagens</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="editingDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="editingDone" class="ml-2 text-sm text-gray-700">Edi√ß√£o</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="coverDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="coverDone" class="ml-2 text-sm text-gray-700">Capa</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="onlineDone" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="onlineDone" class="ml-2 text-sm text-gray-700">Online</label>
                    </div>
                </div>

                <button
                    onclick="addTask()"
                    class="w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                >
                    Adicionar V√≠deo
                </button>
            </div>
        </div>

        <!-- Otimizador Gold (Nova se√ß√£o colaps√°vel) -->
        <div class="mt-8 bg-white rounded-lg shadow p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold gold-text flex items-center gap-2">
                    <span class="icon-tool"></span>
                    Otimizador Gold
                </h2>
                <button id="toggleOptimizerBtn" class="p-1 rounded hover:bg-gray-100">
                    <span class="icon-down"></span>
                </button>
            </div>
            
            <div id="optimizerContent" class="hidden">
                <div id="form" class="flex flex-col items-center gap-4 mb-6">
                    <input type="text" id="fileName" placeholder="Nome do arquivo" class="w-full p-2 gold-input rounded" />
                    <input type="number" id="charCount" placeholder="Dividir em quantos caracteres:" value="490" class="w-full p-2 gold-input rounded" />
                    <textarea id="textInput" rows="10" placeholder="Insira o texto aqui..." class="w-full p-2 gold-input rounded"></textarea>
                    <div class="flex gap-2 w-full">
                        <button onclick="divideTextByChars()" class="flex-1 p-3 gold-button rounded">Dividir por Caracteres</button>
                        <button onclick="resetForm()" class="flex-1 p-3 gold-button rounded">Redefinir</button>
                    </div>
                    
                    <div class="w-full flex flex-col gap-2">
                        <label for="speed" class="text-sm gold-text">Espa√ßamento entre √°udios:</label>
                        <div class="flex items-center gap-2">
                            <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1" class="flex-1">
                            <span id="speedValue" class="gold-text">1.0x</span>
                        </div>
                    </div>
                    
                    <div class="w-full flex flex-col gap-2">
                        <label for="readingRate" class="text-sm gold-text">Caracteres por segundo:</label>
                        <div class="flex items-center gap-2">
                            <input type="range" id="readingRate" min="10" max="50" step="1" value="14" class="flex-1">
                            <span id="readingRateValue" class="gold-text">14 c/s</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 w-full">
                        <button onclick="exportToSrt()" class="flex-1 p-3 gold-button rounded">Exportar para SRT</button>
                        <button onclick="exportToPdf()" class="flex-1 p-3 gold-button rounded">Exportar para PDF</button>
                    </div>
                </div>
                
                <div id="preview" class="mb-4 text-center text-indigo-900"></div>
                <div id="totalInfo" class="text-center text-sm mb-4 text-indigo-900"></div>
                <div id="blocks" class="flex flex-col gap-2"></div>
                <p class="text-center mt-4 gold-text">O sonho √© a coisa mais real que Existe! Gratid√£o</p>
            </div>
        </div>

        <!-- Lista de Tarefas -->
        <div id="taskListContainer" class="mt-8 bg-white rounded-lg shadow p-4 hidden">
            <h2 class="text-xl font-semibold mb-4">Lista de Tarefas</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Canal</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">C√≥digo</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">T√≠tulo</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progresso</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descri√ß√£o</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="taskList" class="bg-white divide-y divide-gray-200">
                        <!-- Tasks ser√£o inseridas dinamicamente aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        /*** C√ìDIGO DO SISTEMA DE ACOMPANHAMENTO DE V√çDEOS ***/
        
        // Vari√°veis globais
        let tasks = [];
        let editingTaskId = null;
        let editingField = null;
        let showDescriptionId = null;
        let showTaskForm = true;

        // Vari√°veis de data
        const today = new Date();
        const currentDay = today.getDate();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();
        
        // M√™s e ano de visualiza√ß√£o do calend√°rio
        let viewMonth = currentMonth;
        let viewYear = currentYear;
        
        // Nomes dos meses
        const monthNames = [
            "Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
            "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
        ];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa√ß√£o do Sistema de Acompanhamento
            initializeVideoTracker();
            
            // Inicializa√ß√£o do Otimizador Gold
            initializeGoldOptimizer();
        });

        function initializeVideoTracker() {
            // Preencher os anos no seletor (de hoje at√© 2030)
            populateYearSelect();
            
            // Preencher os dias no seletor
            updateDaySelect();
            
            // Configurar eventos para mudan√ßa de m√™s ou ano
            document.getElementById('scheduledMonth').addEventListener('change', updateDaySelect);
            document.getElementById('scheduledYear').addEventListener('change', updateDaySelect);

            // Definir m√™s e ano atual no formul√°rio
            document.getElementById('scheduledMonth').value = currentMonth;
            document.getElementById('scheduledYear').value = currentYear;
            updateDaySelect();

            // Atualizar t√≠tulo do calend√°rio
            updateCalendarTitle();
            
            // Carregar dados do localStorage
            loadTasks();
            
            // Renderizar o calend√°rio e as tarefas
            renderCalendar();
            renderTasks();
            
            // Configurar o bot√£o de alternar o formul√°rio
            document.getElementById('toggleFormBtn').addEventListener('click', toggleTaskForm);

            // Atualizar contador de caracteres inicial
            updateCharCount('title', 'titleCount', 200);
            updateCharCount('description', 'descriptionCount', 2000);
            
            // Configurar o bot√£o de alternar o Otimizador Gold
            document.getElementById('toggleOptimizerBtn').addEventListener('click', toggleOptimizer);
        }

        // Alternar a visibilidade do Otimizador Gold
        function toggleOptimizer() {
            const content = document.getElementById('optimizerContent');
            const button = document.getElementById('toggleOptimizerBtn');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                button.innerHTML = '<span class="icon-up"></span>';
            } else {
                content.classList.add('hidden');
                button.innerHTML = '<span class="icon-down"></span>';
            }
        }

        // Encontrar e destacar uma tarefa espec√≠fica
        function findAndHighlightTask(taskId) {
            // Primeiro, certifique-se que a lista de tarefas est√° vis√≠vel
            const taskListContainer = document.getElementById('taskListContainer');
            if (taskListContainer.classList.contains('hidden')) {
                taskListContainer.classList.remove('hidden');
            }
            
            // Localizar a linha da tarefa
            const taskRow = document.getElementById(`task-row-${taskId}`);
            if (taskRow) {
                // Rolar at√© a tarefa
                taskRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Destacar a tarefa
                taskRow.classList.add('task-highlight');
                
                // Remover a classe de destaque ap√≥s a anima√ß√£o
                setTimeout(() => {
                    taskRow.classList.remove('task-highlight');
                }, 2000);
            }
        }

        // Navegar entre meses
        function navigateMonth(direction) {
            // Atualizar m√™s e ano de visualiza√ß√£o
            viewMonth += direction;
            
            // Tratamento de virada de ano
            if (viewMonth > 11) {
                viewMonth = 0;
                viewYear++;
            } else if (viewMonth < 0) {
                viewMonth = 11;
                viewYear--;
            }
            
            // Atualizar t√≠tulo e calend√°rio
            updateCalendarTitle();
            renderCalendar();
        }

        // Preencher a sele√ß√£o de anos
        function populateYearSelect() {
            const yearSelect = document.getElementById('scheduledYear');
            const startYear = currentYear;
            const endYear = 2030;
            
            for (let year = startYear; year <= endYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Atualizar sele√ß√£o de dias com base no m√™s e ano selecionados
        function updateDaySelect() {
            const daySelect = document.getElementById('scheduledDay');
            const monthSelect = document.getElementById('scheduledMonth');
            const yearSelect = document.getElementById('scheduledYear');
            
            const selectedMonth = parseInt(monthSelect.value);
            const selectedYear = parseInt(yearSelect.value);
            
            // Limpar op√ß√£o atual
            daySelect.innerHTML = '<option value="">Dia</option>';
            
            // Se m√™s e ano n√£o foram selecionados, n√£o preencha os dias
            if (isNaN(selectedMonth) || isNaN(selectedYear)) {
                return;
            }
            
            // Obter n√∫mero de dias no m√™s selecionado
            const daysInSelectedMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
            
            // Preencher os dias
            for (let day = 1; day <= daysInSelectedMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                daySelect.appendChild(option);
            }
        }

        // Atualizar o t√≠tulo do calend√°rio com o m√™s de visualiza√ß√£o
        function updateCalendarTitle() {
            document.getElementById('calendarTitle').textContent = 
                `Calend√°rio de Produ√ß√£o - ${monthNames[viewMonth]} de ${viewYear}`;
        }

        // Alternar a visibilidade do formul√°rio
        function toggleTaskForm() {
            showTaskForm = !showTaskForm;
            const formContent = document.getElementById('taskForm');
            const toggleBtn = document.getElementById('toggleFormBtn');
            
            if (showTaskForm) {
                formContent.style.display = 'block';
                toggleBtn.innerHTML = '<span class="icon-up"></span>';
            } else {
                formContent.style.display = 'none';
                toggleBtn.innerHTML = '<span class="icon-down"></span>';
            }
        }

        // Atualizar contador de caracteres
        function updateCharCount(inputId, counterId, maxChars) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            if (input && counter) {
                const currentLength = input.value.length;
                counter.textContent = `${currentLength}/${maxChars} caracteres`;
            }
        }

        // Carregar tarefas do localStorage
        function loadTasks() {
            const savedTasks = localStorage.getItem('videoProductionTasks');
            if (savedTasks) {
                try {
                    const loadedTasks = JSON.parse(savedTasks);
                    
                    // Converter formato antigo (se existir) para o novo formato
                    tasks = loadedTasks.map(task => {
                        if (task.scheduledDay && !task.scheduledMonth && !task.scheduledYear) {
                            // Formato antigo, converter para novo formato
                            return {
                                ...task,
                                scheduledMonth: currentMonth,
                                scheduledYear: currentYear
                            };
                        }
                        return task;
                    });
                    
                    updateLastSavedTime();
                } catch (error) {
                    console.error('Erro ao carregar dados salvos:', error);
                }
            }
        }

        // Salvar tarefas no localStorage
        function saveTasks() {
            localStorage.setItem('videoProductionTasks', JSON.stringify(tasks));
            localStorage.setItem('lastSaved', Date.now().toString());
            updateLastSavedTime();
        }

        // Atualizar a hora do √∫ltimo salvamento
        function updateLastSavedTime() {
            const lastSavedTime = localStorage.getItem('lastSaved');
            if (lastSavedTime) {
                const date = new Date(parseInt(lastSavedTime));
                document.getElementById('lastSaved').textContent = `√öltimo salvamento: ${date.toLocaleString()}`;
            }
        }

        // Renderizar o calend√°rio
        function renderCalendar() {
            const calendarMatrix = document.getElementById('calendarMatrix');
            calendarMatrix.innerHTML = '';
            
            // Obter n√∫mero de dias no m√™s de visualiza√ß√£o
            const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
            
            // Verificar se est√° visualizando o m√™s atual
            const isCurrentMonth = (viewMonth === currentMonth && viewYear === currentYear);
            
            // Obter canais √∫nicos
            const channels = [...new Set(tasks.filter(task => task.channel).map(task => task.channel))];
            
            // Criar a tabela do calend√°rio
            const table = document.createElement('table');
            table.className = 'w-full border-collapse';
            
            // Criar o cabe√ßalho com os dias do m√™s
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.className = 'bg-gray-100';
            
            // C√©lula para o nome do canal
            const channelHeader = document.createElement('th');
            channelHeader.className = 'p-2 border text-left font-medium';
            channelHeader.textContent = 'Canal';
            headerRow.appendChild(channelHeader);
            
            // C√©lulas para os dias do m√™s
            for (let day = 1; day <= daysInMonth; day++) {
                const dayHeader = document.createElement('th');
                dayHeader.className = `p-1 border text-center font-medium w-14 ${isCurrentMonth && day === currentDay ? 'bg-blue-100' : ''}`;
                dayHeader.textContent = day;
                headerRow.appendChild(dayHeader);
            }
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Criar o corpo da tabela
            const tbody = document.createElement('tbody');
            
            if (channels.length > 0) {
                channels.forEach(channel => {
                    const row = document.createElement('tr');
                    
                    // C√©lula para o nome do canal
                    const channelCell = document.createElement('td');
                    channelCell.className = 'p-2 border font-medium';
                    channelCell.textContent = channel;
                    row.appendChild(channelCell);
                    
                    // C√©lulas para os dias
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayCell = document.createElement('td');
                        // C√©lulas mais estreitas
                        dayCell.className = `p-1 border align-top h-10 ${isCurrentMonth && day === currentDay ? 'bg-blue-50' : ''}`;
                        
                        // Filtrar tarefas para este dia, m√™s, ano e canal
                        const cellTasks = tasks.filter(task => 
                            parseInt(task.scheduledDay) === day && 
                            parseInt(task.scheduledMonth) === viewMonth &&
                            parseInt(task.scheduledYear) === viewYear &&
                            task.channel === channel
                        );
                        
                        // Adicionar as tarefas a esta c√©lula
                        cellTasks.forEach(task => {
                            const status = getTaskStatus(task);
                            let statusColor = 'bg-gray-200'; // N√£o iniciado
                            
                            if (status === 'Em progresso') statusColor = 'bg-yellow-200';
                            if (status === 'Conclu√≠do') statusColor = 'bg-green-200';
                            
                            const taskDiv = document.createElement('div');
                            taskDiv.className = `mb-1 p-1 text-xs rounded ${statusColor} truncate cursor-pointer hover:bg-gray-100`;
                            taskDiv.title = `${task.title} - Clique para ver detalhes`;
                            taskDiv.textContent = `[${task.channel} ${task.videoCode || ''}]`;
                            
                            // Adicionar evento de clique para rolar at√© a tarefa
                            taskDiv.onclick = function() {
                                findAndHighlightTask(task.id);
                            };
                            
                            dayCell.appendChild(taskDiv);
                        });
                        
                        row.appendChild(dayCell);
                    }
                    
                    tbody.appendChild(row);
                });
            } else {
                // Mensagem para quando n√£o houver canais
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = daysInMonth + 1;
                cell.className = 'p-4 text-center text-gray-500';
                cell.textContent = 'Nenhum canal cadastrado. Adicione v√≠deos abaixo para popular a matriz.';
                row.appendChild(cell);
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            calendarMatrix.appendChild(table);
        }

        // Formata√ß√£o da data para exibi√ß√£o (DD/MM/YYYY)
        function formatDate(day, month, year) {
            return `${day.toString().padStart(2, '0')}/${(parseInt(month) + 1).toString().padStart(2, '0')}/${year}`;
        }

        // Renderizar a lista de tarefas
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const taskListContainer = document.getElementById('taskListContainer');
            
            // Mostrar/esconder o container de lista de tarefas
            if (tasks.length > 0) {
                taskListContainer.classList.remove('hidden');
            } else {
                taskListContainer.classList.add('hidden');
                return;
            }
            
            taskList.innerHTML = '';
            
            // Ordenar tarefas pelo ID (timestamp) em ordem decrescente
            // para que as mais recentes apare√ßam no topo
            const sortedTasks = [...tasks].sort((a, b) => b.id - a.id);
            
            sortedTasks.forEach(task => {
                // Criando a linha principal
                const row = document.createElement('tr');
                // Adicionar ID para facilitar a navega√ß√£o
                row.id = `task-row-${task.id}`;
                row.className = "transition-all duration-500";
                
                // Canal
                row.innerHTML += `<td class="px-4 py-2 whitespace-nowrap">${task.channel}</td>`;
                
                // C√≥digo
                row.innerHTML += `<td class="px-4 py-2 whitespace-nowrap">${task.videoCode || ''}</td>`;
                
                // T√≠tulo
                let titleCell = document.createElement('td');
                titleCell.className = 'px-4 py-2';
                
                if (editingTaskId === task.id && editingField === 'title') {
                    titleCell.innerHTML = `
                        <input
                            type="text"
                            id="edit-title-${task.id}"
                            value="${task.title}"
                            class="w-full p-1 border rounded"
                            maxlength="200"
                            autofocus
                        >
                        <div class="flex justify-end mt-1">
                            <button onclick="cancelEditing()" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-xs mr-1">Cancelar</button>
                            <button onclick="saveEditing(${task.id}, 'title')" class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">Salvar</button>
                        </div>
                    `;
                } else {
                    titleCell.innerHTML = `
                        <div class="truncate max-w-xs flex items-center" title="${task.title}" onclick="startEditing(${task.id}, 'title', '${escapeHtml(task.title)}')">
                            ${task.title}
                            <span class="icon-edit ml-1 text-gray-400 hover:text-gray-600 text-xs"></span>
                        </div>
                    `;
                }
                row.appendChild(titleCell);
                
                // Data
                let dateCell = document.createElement('td');
                dateCell.className = 'px-4 py-2 whitespace-nowrap';
                
                if (editingTaskId === task.id && editingField === 'scheduledDate') {
                    dateCell.innerHTML = `
                        <div class="flex flex-col gap-2">
                            <select id="edit-day-${task.id}" class="p-1 border rounded">
                                <!-- Dias ser√£o preenchidos dinamicamente -->
                            </select>
                            <select id="edit-month-${task.id}" class="p-1 border rounded" onchange="updateEditDayOptions(${task.id})">
                                <option value="0" ${task.scheduledMonth == 0 ? 'selected' : ''}>Janeiro</option>
                                <option value="1" ${task.scheduledMonth == 1 ? 'selected' : ''}>Fevereiro</option>
                                <option value="2" ${task.scheduledMonth == 2 ? 'selected' : ''}>Mar√ßo</option>
                                <option value="3" ${task.scheduledMonth == 3 ? 'selected' : ''}>Abril</option>
                                <option value="4" ${task.scheduledMonth == 4 ? 'selected' : ''}>Maio</option>
                                <option value="5" ${task.scheduledMonth == 5 ? 'selected' : ''}>Junho</option>
                                <option value="6" ${task.scheduledMonth == 6 ? 'selected' : ''}>Julho</option>
                                <option value="7" ${task.scheduledMonth == 7 ? 'selected' : ''}>Agosto</option>
                                <option value="8" ${task.scheduledMonth == 8 ? 'selected' : ''}>Setembro</option>
                                <option value="9" ${task.scheduledMonth == 9 ? 'selected' : ''}>Outubro</option>
                                <option value="10" ${task.scheduledMonth == 10 ? 'selected' : ''}>Novembro</option>
                                <option value="11" ${task.scheduledMonth == 11 ? 'selected' : ''}>Dezembro</option>
                            </select>
                            <select id="edit-year-${task.id}" class="p-1 border rounded" onchange="updateEditDayOptions(${task.id})">
                                <!-- Anos ser√£o preenchidos dinamicamente -->
                            </select>
                            <div class="flex justify-end mt-1">
                                <button onclick="cancelEditing()" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-xs mr-1">Cancelar</button>
                                <button onclick="saveEditedDate(${task.id})" class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">Salvar</button>
                            </div>
                        </div>
                    `;
                    
                    // Preencher anos e dias dinamicamente ap√≥s renderizar
                    setTimeout(() => {
                        fillEditYearOptions(task.id, task.scheduledYear);
                        updateEditDayOptions(task.id, task.scheduledDay);
                    }, 10);
                } else {
                    const dateStr = formatDate(
                        task.scheduledDay, 
                        task.scheduledMonth !== undefined ? task.scheduledMonth : currentMonth, 
                        task.scheduledYear !== undefined ? task.scheduledYear : currentYear
                    );
                    
                    dateCell.innerHTML = `
                        <div class="flex items-center cursor-pointer" onclick="startEditingDate(${task.id})">
                            ${dateStr}
                            <span class="icon-edit ml-1 text-gray-400 hover:text-gray-600 text-xs"></span>
                        </div>
                    `;
                }
                row.appendChild(dateCell);
                
                // Status
                const status = getTaskStatus(task);
                let statusColor = 'bg-gray-100 text-gray-800';
                
                if (status === 'Em progresso') statusColor = 'bg-yellow-100 text-yellow-800';
                if (status === 'Conclu√≠do') statusColor = 'bg-green-100 text-green-800';
                
                row.innerHTML += `
                    <td class="px-4 py-2 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${statusColor}">
                            ${status}
                        </span>
                    </td>
                `;
                
                // Progresso
                let progressCell = document.createElement('td');
                progressCell.className = 'px-4 py-2';
                
                const checkboxes = [
                    { id: 'scriptDone', label: 'Roteiro' },
                    { id: 'narrationDone', label: 'Narra√ß√£o' },
                    { id: 'imagesDone', label: 'Imagens' },
                    { id: 'editingDone', label: 'Edi√ß√£o' },
                    { id: 'coverDone', label: 'Capa' },
                    { id: 'onlineDone', label: 'Online' }
                ];
                
                let progressHtml = '<div class="flex flex-wrap gap-2">';
                
                checkboxes.forEach(checkbox => {
                    const isChecked = task[checkbox.id];
                    progressHtml += `
                        <button onclick="toggleTaskCheckbox(${task.id}, '${checkbox.id}')" class="flex items-center text-xs">
                            <span class="${isChecked ? 'icon-checked text-green-600' : 'icon-unchecked text-gray-400'}"></span>
                            <span class="ml-1">${checkbox.label}</span>
                        </button>
                    `;
                });
                
                progressHtml += '</div>';
                progressCell.innerHTML = progressHtml;
                row.appendChild(progressCell);
                
                // Descri√ß√£o
                let descriptionCell = document.createElement('td');
                descriptionCell.className = 'px-4 py-2';
                
                if (showDescriptionId === task.id && editingTaskId === task.id && editingField === 'description') {
                    descriptionCell.innerHTML = `<div class="text-xs text-gray-500">Editando descri√ß√£o abaixo...</div>`;
                } else {
                    descriptionCell.innerHTML = `
                        <button 
                            onclick="toggleDescription(${task.id})"
                            class="p-1 rounded hover:bg-gray-100 flex items-center text-xs text-gray-600"
                        >
                            ${showDescriptionId === task.id ? 
                                `<span class="icon-up mr-1"></span> Ocultar` : 
                                `<span class="icon-down mr-1"></span> Mostrar`
                            }
                        </button>
                    `;
                }
                row.appendChild(descriptionCell);
                
                // Bot√£o de excluir
                let deleteCell = document.createElement('td');
                deleteCell.className = 'px-4 py-2';
                deleteCell.innerHTML = `
                    <button 
                        onclick="confirmDeleteTask(${task.id})"
                        class="p-1 rounded hover:bg-red-100 text-red-600"
                        title="Excluir tarefa"
                    >
                        <span class="icon-delete"></span>
                    </button>
                `;
                row.appendChild(deleteCell);
                
                taskList.appendChild(row);
                
                // Adicionar a linha de descri√ß√£o se estiver sendo exibida
                if (showDescriptionId === task.id) {
                    const descriptionRow = document.createElement('tr');
                    const descriptionContent = document.createElement('td');
                    descriptionContent.colSpan = 8; // Para todas as colunas
                    descriptionContent.className = 'px-4 py-2 bg-gray-50';
                    
                    if (editingTaskId === task.id && editingField === 'description') {
                        descriptionContent.innerHTML = `
                            <div class="flex flex-col">
                                <textarea
                                    id="edit-description-${task.id}"
                                    class="w-full p-2 border rounded mb-2"
                                    rows="4"
                                    maxlength="2000"
                                    placeholder="Descri√ß√£o do v√≠deo"
                                >${task.description || ''}</textarea>
                                <div class="flex justify-end gap-2">
                                    <span class="text-xs text-gray-500 self-center mr-2">
                                        ${(task.description || '').length}/2000 caracteres
                                    </span>
                                    <button 
                                        onclick="cancelEditing()" 
                                        class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm"
                                    >
                                        Cancelar
                                    </button>
                                    <button 
                                        onclick="saveEditing(${task.id}, 'description')" 
                                        class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                                    >
                                        Salvar
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        descriptionContent.innerHTML = `
                            <div 
                                class="text-sm text-gray-700 whitespace-pre-wrap flex items-start"
                                onclick="startEditing(${task.id}, 'description', '${escapeHtml(task.description || '')}')"
                            >
                                <div class="flex-grow">
                                    ${task.description ? task.description : '<span class="text-gray-400 italic">Sem descri√ß√£o</span>'}
                                </div>
                                <span class="icon-edit ml-2 text-gray-400 hover:text-gray-600 flex-shrink-0 mt-1"></span>
                            </div>
                        `;
                    }
                    
                    descriptionRow.appendChild(descriptionContent);
                    taskList.appendChild(descriptionRow);
                }
            });
        }

        // Iniciar edi√ß√£o da data
        function startEditingDate(taskId) {
            editingTaskId = taskId;
            editingField = 'scheduledDate';
            renderTasks();
        }

        // Preencher as op√ß√µes de ano para edi√ß√£o
        function fillEditYearOptions(taskId, selectedYear) {
            const yearSelect = document.getElementById(`edit-year-${taskId}`);
            if (!yearSelect) return;
            
            yearSelect.innerHTML = '';
            
            const startYear = currentYear;
            const endYear = 2030;
            
            for (let year = startYear; year <= endYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year == selectedYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // Atualizar op√ß√µes de dia na edi√ß√£o de data
        function updateEditDayOptions(taskId, selectedDay) {
            const daySelect = document.getElementById(`edit-day-${taskId}`);
            const monthSelect = document.getElementById(`edit-month-${taskId}`);
            const yearSelect = document.getElementById(`edit-year-${taskId}`);
            
            if (!daySelect || !monthSelect || !yearSelect) return;
            
            const selectedMonth = parseInt(monthSelect.value);
            const selectedYear = parseInt(yearSelect.value);
            
            // Limpar op√ß√µes atuais
            daySelect.innerHTML = '';
            
            // Obter n√∫mero de dias no m√™s selecionado
            const daysInSelectedMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
            
            // Preencher os dias
            for (let day = 1; day <= daysInSelectedMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                if (day == selectedDay) {
                    option.selected = true;
                }
                daySelect.appendChild(option);
            }
        }

        // Salvar a data editada
        function saveEditedDate(taskId) {
            const daySelect = document.getElementById(`edit-day-${taskId}`);
            const monthSelect = document.getElementById(`edit-month-${taskId}`);
            const yearSelect = document.getElementById(`edit-year-${taskId}`);
            
            if (!daySelect || !monthSelect || !yearSelect) return;
            
            const day = parseInt(daySelect.value);
            const month = parseInt(monthSelect.value);
            const year = parseInt(yearSelect.value);
            
            tasks = tasks.map(task => {
                if (task.id === taskId) {
                    return {
                        ...task,
                        scheduledDay: day,
                        scheduledMonth: month,
                        scheduledYear: year
                    };
                }
                return task;
            });
            
            editingTaskId = null;
            editingField = null;
            
            saveTasks();
            renderCalendar();
            renderTasks();
        }

        // Escapar HTML para evitar problemas com aspas em strings
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Confirmar antes de excluir tarefa
        function confirmDeleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            if (confirm(`Tem certeza que deseja excluir o v√≠deo "${task.title}" do canal "${task.channel}"?`)) {
                deleteTask(taskId);
            }
        }

        // Excluir tarefa
        function deleteTask(taskId) {
            tasks = tasks.filter(task => task.id !== taskId);
            saveTasks();
            renderCalendar();
            renderTasks();
        }

        // Adicionar uma nova tarefa
        function addTask() {
            const channel = document.getElementById('channel').value.trim();
            const videoCode = document.getElementById('videoCode').value.trim();
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const scheduledDay = document.getElementById('scheduledDay').value;
            const scheduledMonth = document.getElementById('scheduledMonth').value;
            const scheduledYear = document.getElementById('scheduledYear').value;
            
            if (!channel || !title || !scheduledDay || !scheduledMonth || !scheduledYear) {
                alert('Por favor, preencha pelo menos o canal, t√≠tulo e data programada completa.');
                return;
            }
            
            const newTask = {
                id: Date.now(),
                channel,
                videoCode,
                title,
                description,
                scheduledDay,
                scheduledMonth,
                scheduledYear,
                scriptDone: document.getElementById('scriptDone').checked,
                narrationDone: document.getElementById('narrationDone').checked,
                imagesDone: document.getElementById('imagesDone').checked,
                editingDone: document.getElementById('editingDone').checked,
                coverDone: document.getElementById('coverDone').checked,
                onlineDone: document.getElementById('onlineDone').checked
            };
            
            tasks.push(newTask);
            saveTasks();
            
            // Limpar o formul√°rio
            document.getElementById('channel').value = '';
            document.getElementById('videoCode').value = '';
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('scheduledDay').value = '';
            document.getElementById('scriptDone').checked = false;
            document.getElementById('narrationDone').checked = false;
            document.getElementById('imagesDone').checked = false;
            document.getElementById('editingDone').checked = false;
            document.getElementById('coverDone').checked = false;
            document.getElementById('onlineDone').checked = false;
            
            // Atualizar contador de caracteres
            updateCharCount('title', 'titleCount', 200);
            updateCharCount('description', 'descriptionCount', 2000);
            
            // Atualizar visualiza√ß√µes
            renderCalendar();
            renderTasks();
            
            // Destacar a nova tarefa adicionada
            findAndHighlightTask(newTask.id);
        }

        // Iniciar edi√ß√£o de um campo
        function startEditing(taskId, field, value) {
            editingTaskId = taskId;
            editingField = field;
            
            // Atualizar a visualiza√ß√£o
            renderTasks();
            
            // Focar no campo de edi√ß√£o
            setTimeout(() => {
                const editField = document.getElementById(`edit-${field}-${taskId}`);
                if (editField) {
                    editField.focus();
                    if (field === 'title') {
                        editField.select();
                    }
                }
            }, 10);
        }

        // Salvar valor editado
        function saveEditing(taskId, field) {
            const editField = document.getElementById(`edit-${field}-${taskId}`);
            if (!editField) return;
            
            const value = editField.value;
            
            tasks = tasks.map(task => {
                if (task.id === taskId) {
                    return {
                        ...task,
                        [field]: value
                    };
                }
                return task;
            });
            
            editingTaskId = null;
            editingField = null;
            
            saveTasks();
            renderCalendar();
            renderTasks();
        }

        // Cancelar edi√ß√£o
        function cancelEditing() {
            editingTaskId = null;
            editingField = null;
            renderTasks();
        }

        // Alternar visibilidade da descri√ß√£o
        function toggleDescription(taskId) {
            showDescriptionId = (showDescriptionId === taskId) ? null : taskId;
            renderTasks();
        }

        // Alternar checkbox de uma tarefa
        function toggleTaskCheckbox(taskId, field) {
            tasks = tasks.map(task => {
                if (task.id === taskId) {
                    return {
                        ...task,
                        [field]: !task[field]
                    };
                }
                return task;
            });
            
            saveTasks();
            renderCalendar();
            renderTasks();
        }

        // Obter status de uma tarefa
        function getTaskStatus(task) {
            const checkboxes = [
                task.scriptDone, 
                task.narrationDone, 
                task.imagesDone, 
                task.editingDone, 
                task.coverDone, 
                task.onlineDone
            ];
            
            if (checkboxes.every(check => check)) {
                return 'Conclu√≠do';
            } else if (checkboxes.some(check => check)) {
                return 'Em progresso';
            } else {
                return 'N√£o iniciado';
            }
        }

        // Exportar dados como arquivo JSON
        function exportData() {
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `video-production-tasks-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Importar dados de arquivo JSON
        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedTasks = JSON.parse(e.target.result);
                        tasks = importedTasks;
                        saveTasks();
                        renderCalendar();
                        renderTasks();
                    } catch (error) {
                        alert('Erro ao importar arquivo. Certifique-se de que √© um JSON v√°lido.');
                        console.error('Erro importando arquivo:', error);
                    }
                };
                reader.readAsText(file);
            }
        }

        /*** C√ìDIGO DO OTIMIZADOR GOLD ***/
        
        // Vari√°veis para o Otimizador Gold
        const PAUSE_TIME = 0.9; // Tempo de pausa entre blocos (segundos)
        
        function initializeGoldOptimizer() {
            document.getElementById('speed').addEventListener('input', function() {
                document.getElementById('speedValue').innerText = this.value + 'x';
            });

            document.getElementById('readingRate').addEventListener('input', function() {
                document.getElementById('readingRateValue').innerText = this.value + ' c/s';
            });
        }
        
        function copyToClipboard(text, button) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            if (button) {
                button.classList.add('copied');
                button.textContent = 'Copiado!';
            }
        }

        function exportToSrt() {
            const speed = parseFloat(document.getElementById('speed').value);
            const blocks = document.querySelectorAll('.block .srt');
            let srtContent = '';
            blocks.forEach((block, index) => {
                const startTime = adjustTimestamp(block.dataset.startTime, speed);
                const endTime = adjustTimestamp(block.dataset.endTime, speed);
                srtContent += `${index + 1}\n${startTime} --> ${endTime}\n${block.innerText.trim()}\n\n`;
            });
            downloadSrtFile(srtContent.trim());
        }

        function adjustTimestamp(timestamp, speed) {
            if (!timestamp) return '00:00:00,000'; // Evita erro se timestamp for indefinido

            const parts = timestamp.split(':');
            const hours = parseInt(parts[0]);
            const minutes = parseInt(parts[1]);
            const secondsParts = parts[2].split(',');
            const seconds = parseInt(secondsParts[0]);
            const milliseconds = parseInt(secondsParts[1]);

            let totalMilliseconds = ((hours * 3600 + minutes * 60 + seconds) * 1000 + milliseconds) * speed;

            const newHours = Math.floor(totalMilliseconds / 3600000);
            totalMilliseconds %= 3600000;
            const newMinutes = Math.floor(totalMilliseconds / 60000);
            totalMilliseconds %= 60000;
            const newSeconds = Math.floor(totalMilliseconds / 1000);
            const newMilliseconds = totalMilliseconds % 1000;

            return `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}:${String(newSeconds).padStart(2, '0')},${String(newMilliseconds).padStart(3, '0')}`;
        }

        function downloadSrtFile(content) {
            const fileName = document.getElementById('fileName').value || 'subtitles';
            const blob = new Blob([content], { type: 'text/srt' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.srt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function createBlock(type, content, startTime, endTime) {
            const blockDiv = document.createElement('div');
            blockDiv.classList.add('block');
            blockDiv.innerHTML = `
                <div class="info">
                    <span>${type}</span>
                    <span>${content.length} caracteres, ${content.split(/\s+/).length} palavras</span>
                </div>
                <div class="srt" data-start-time="${formatTimestamp(startTime)}" data-end-time="${formatTimestamp(endTime)}">
                    ${content}
                </div>
            `;
            document.getElementById('blocks').appendChild(blockDiv);
        }

        function divideTextByChars() {
            if (!validateCharCount()) return;
            const charCount = document.getElementById('charCount').value;
            const text = document.getElementById('textInput').value;

            // Calcular total de caracteres e palavras
            const totalChars = text.length;
            const totalWords = text.split(/\s+/).filter(word => word.length > 0).length;

            // Exibir total de caracteres e palavras
            document.getElementById('totalInfo').textContent = `Total de caracteres: ${totalChars} | Total de palavras: ${totalWords}`;

            const blocks = getTextBlocksWithCustomLength(text, parseInt(charCount));
            document.getElementById('blocks').innerHTML = '';
            let currentTime = 0;
            const readingRate = parseInt(document.getElementById('readingRate').value); // Obt√©m o valor atual do slider
            blocks.forEach((block, index) => {
                const duration = block.length / readingRate;
                const startTime = currentTime;
                const endTime = currentTime + duration;
                createBlock(`Bloco ${index + 1}`, block, startTime, endTime);
                currentTime = endTime + PAUSE_TIME; // adiciona a pausa entre blocos
            });

            // Atualiza a pr√©-visualiza√ß√£o
            updatePreview(blocks);
        }

        function resetForm() {
            document.getElementById('charCount').value = '490';
            document.getElementById('textInput').value = '';
            document.getElementById('blocks').innerHTML = '';
            document.getElementById('totalInfo').textContent = '';
            document.getElementById('preview').innerHTML = '';
        }

        function validateCharCount() {
            const charCount = document.getElementById('charCount').value;
            if (isNaN(charCount) || charCount <= 0) {
                showError("Por favor, insira um n√∫mero v√°lido de caracteres.");
                return false;
            }
            return true;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.classList.add('error');
            errorDiv.textContent = message;
            document.body.prepend(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
        }

        function getTextBlocksWithCustomLength(text, maxLength) {
            text = formatText(text);
            return splitTextIntoBlocks(text, maxLength);
        }

        function formatText(text) {
            // Substitui√ß√µes iniciais
            text = text.replace(/\"/g, "'");
            text = text.replace(/¬´/g, "'").replace(/¬ª/g, "'");
            text = text.replace(/\n/g, " ");
            
            // Vers√£o corrigida sem adicionar espa√ßos extras
            text = text.replace(/([.,!?;:])([a-zA-Z])/g, "$1 $2"); // Adiciona espa√ßo apenas ap√≥s pontua√ß√£o seguida de letra
            
            // Ajusta espa√ßos para retic√™ncias
            text = text.replace(/\. \. \./g, "...");
            
            // Ajusta aspas simples sem adicionar espa√ßos extras
            text = text.replace(/'(\S)/g, "' $1").replace(/(\S)'/g, "$1 '");
            
            // Remove espa√ßos m√∫ltiplos
            text = text.replace(/\s+/g, " ");
            
            return text;
        }

        function splitTextIntoBlocks(text, maxLength) {
            const blocks = [];
            let currentBlock = "";
            const sentences = text.split(/(?<=\.|\?|!)(?=\s)/g);

            for (let i = 0; i < sentences.length; i++) {
                const sentence = sentences[i].trim();
                if ((currentBlock.length + sentence.length + 1) <= maxLength) {
                    currentBlock += sentence + " ";
                } else {
                    if (currentBlock.trim().length > 0) {
                        blocks.push(currentBlock.trim());
                    }
                    currentBlock = sentence + " ";
                }
            }

            if (currentBlock.trim().length > 0) {
                blocks.push(currentBlock.trim());
            }

            return blocks;
        }

        function formatTimestamp(seconds) {
            const date = new Date(seconds * 1000);
            const hours = String(date.getUTCHours()).padStart(2, '0');
            const minutes = String(date.getUTCMinutes()).padStart(2, '0');
            const secs = String(date.getUTCSeconds()).padStart(2, '0');
            const millis = String(date.getUTCMilliseconds()).padStart(3, '0');
            return `${hours}:${minutes}:${secs},${millis}`;
        }

        function updatePreview(blocks) {
            const previewDiv = document.getElementById('preview');
            previewDiv.innerHTML = '';
            blocks.forEach((block, index) => {
                const previewItem = document.createElement('div');
                previewItem.textContent = `Bloco ${index + 1}: ${block}`;
                previewDiv.appendChild(previewItem);
            });
        }

        async function exportToPdf() {
            const { jsPDF } = window.jspdf;
            const fileName = document.getElementById('fileName').value || 'documento';

            const doc = new jsPDF();
            const blocks = document.querySelectorAll('.block');

            if (blocks.length > 0) {
                let y = 10; // posi√ß√£o inicial

                blocks.forEach((block, index) => {
                    const blockContent = block.querySelector('.srt').innerText;
                    const blockInfo = `Bloco ${index + 1}\n${blockContent}`;
                    
                    // Adiciona o texto do bloco ao PDF
                    const lines = doc.splitTextToSize(blockInfo, 180); // Divide o texto em linhas com largura m√°xima de 180 unidades
                    lines.forEach(line => {
                        doc.text(line, 10, y);
                        y += 10;

                        // Adiciona nova p√°gina se necess√°rio
                        if (y > 270) {
                            doc.addPage();
                            y = 10;
                        }
                    });

                    y += 10; // Adiciona um espa√ßo ap√≥s cada bloco
                });
            } else {
                const text = document.getElementById('textInput').value;
                const lines = doc.splitTextToSize(text, 180); // Divide o texto em linhas com largura m√°xima de 180 unidades

                let y = 10; // posi√ß√£o inicial

                lines.forEach((line) => {
                    // Adiciona o texto ao PDF
                    doc.text(line, 10, y);
                    
                    // Atualiza a posi√ß√£o para a pr√≥xima linha
                    y += 10;

                    // Adiciona nova p√°gina se necess√°rio
                    if (y > 270) {
                        doc.addPage();
                        y = 10;
                    }
                });
            }

            // Salva o PDF com nome definido pelo usu√°rio
            doc.save(`${fileName}.pdf`);
        }
    </script>
</body>
</html>